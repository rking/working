#!/usr/bin/env ruby

def green_say verb, noun
  puts "  \e[32;1m#{verb}\e[0m  #{noun}"
end

def is_rails?; File.exists? 'config/environment.ru' end

fail "No automatic setup for Rails, yet" if is_rails?

unless Dir.exists? 'test'
  green_say 'mkdir', 'test'
  Dir.mkdir 'test'
end

{
  'Gemfile' => [
    'source :rubygems',
    %{group :development do gem 'working' end},
    # Rails TODO %{group :development do gem 'pry-rails' end},
  ],
  'Guardfile' => [
    %{require 'working/guard'},
    '# vim ft=ruby',
  ],
  'Rakefile' => [
    %{require 'working/rake_tasks'}
  ],
  'test/test_helper.rb' => [
    %{require 'working/test_helper'},
    # Rails TODO  %{require 'working/rails_test_helper'},
    %{# Spork.prefork doesn't like when this is missing},
  ],
}.each do |path, content|
  if File.exist? path
    green_say 'found', path
  else
    green_say 'create', path
    File.write path, ''
  end
  existing = File.read path
  content.each do |line|
    next if existing[line]
    puts "    #{line}"
    File.write path, line + "\n", mode: 'a'
  end
end
